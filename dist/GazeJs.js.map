{"version":3,"sources":["webpack://GazeJs/webpack/bootstrap","webpack://GazeJs/webpack/runtime/define property getters","webpack://GazeJs/webpack/runtime/hasOwnProperty shorthand","webpack://GazeJs/./src/Queue.ts","webpack://GazeJs/./src/Subscription.ts","webpack://GazeJs/./src/GazeJs.ts"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Queue","this","queue","isBusy","add","callback","push","process","thisArg","_arguments","generator","body","f","y","t","g","_","label","sent","trys","ops","next","verb","Symbol","iterator","n","v","op","TypeError","done","value","pop","length","e","step","__generator","_a","shift","P","Promise","resolve","reject","fulfilled","rejected","result","then","apply","Subscription","callbackId","payloadCallback","topics","GazeJs","hubUrl","tokenUrl","connected","SSE","token","subscriptions","connect","_this","req","_b","fetch","json","EventSource","onmessage","m","data","JSON","parse","find","s","payload","onopen","on","topicsCallback","subscription","Error","generateCallbackId","update","newTopics","topicsToRemove","topicsToAdd","Array","from","Set","filter","includes","subscribeRequest","method","headers","stringify","UUID","Math","random","toString","substring"],"mappings":"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","file":"GazeJs.js","sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar Queue = /** @class */ (function () {\n    function Queue() {\n        this.queue = [];\n        this.isBusy = false;\n    }\n    Queue.prototype.add = function (callback) {\n        this.queue.push(callback);\n        this.process();\n    };\n    Queue.prototype.process = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.isBusy || this.queue.length == 0)\n                            return [2 /*return*/];\n                        this.isBusy = true;\n                        return [4 /*yield*/, this.queue[0]()];\n                    case 1:\n                        _a.sent();\n                        this.queue.shift();\n                        this.isBusy = false;\n                        this.process();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return Queue;\n}());\nexport { Queue };\n","import { Queue } from \"./Queue\";\nvar Subscription = /** @class */ (function () {\n    function Subscription(callbackId, payloadCallback) {\n        this.callbackId = callbackId;\n        this.payloadCallback = payloadCallback;\n        this.topics = [];\n        this.queue = new Queue();\n    }\n    return Subscription;\n}());\nexport { Subscription };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { Subscription } from \"./Subscription\";\nvar GazeJs = /** @class */ (function () {\n    function GazeJs(hubUrl, tokenUrl) {\n        this.hubUrl = hubUrl;\n        this.tokenUrl = tokenUrl;\n        this.connected = false;\n        this.SSE = null;\n        this.token = null;\n        this.subscriptions = [];\n    }\n    GazeJs.prototype.connect = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve) { return __awaiter(_this, void 0, void 0, function () {\n                        var req, _a;\n                        var _this = this;\n                        return __generator(this, function (_b) {\n                            switch (_b.label) {\n                                case 0: return [4 /*yield*/, fetch(this.tokenUrl)];\n                                case 1:\n                                    req = _b.sent();\n                                    _a = this;\n                                    return [4 /*yield*/, req.json()];\n                                case 2:\n                                    _a.token = (_b.sent()).token;\n                                    this.SSE = new EventSource(this.hubUrl + \"/sse?token=\" + this.token);\n                                    this.SSE.onmessage = function (m) {\n                                        var _a;\n                                        var data = JSON.parse(m.data);\n                                        (_a = _this.subscriptions.find(function (s) { return s.callbackId == data.callbackId; })) === null || _a === void 0 ? void 0 : _a.payloadCallback(data.payload);\n                                    };\n                                    this.SSE.onopen = function () {\n                                        _this.connected = true;\n                                        resolve(_this);\n                                    };\n                                    return [2 /*return*/];\n                            }\n                        });\n                    }); })];\n            });\n        });\n    };\n    GazeJs.prototype.on = function (topicsCallback, payloadCallback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var subscription;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.connected)\n                            throw new Error(\"Gaze is not connected to a hub\");\n                        subscription = new Subscription(this.generateCallbackId(), payloadCallback);\n                        this.subscriptions.push(subscription);\n                        return [4 /*yield*/, this.update(subscription, topicsCallback)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, {\n                                update: function () { return _this.update(subscription, topicsCallback); }\n                            }];\n                }\n            });\n        });\n    };\n    GazeJs.prototype.update = function (subscription, topicsCallback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var newTopics, topicsToRemove, topicsToAdd;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, topicsCallback()];\n                    case 1:\n                        newTopics = _a.sent();\n                        newTopics = Array.from(new Set(newTopics));\n                        topicsToRemove = subscription.topics.filter(function (t) { return !newTopics.includes(t); });\n                        topicsToAdd = newTopics.filter(function (t) { return !subscription.topics.includes(t); });\n                        if (topicsToRemove.length + topicsToAdd.length == 0)\n                            return [2 /*return*/];\n                        subscription.queue.add(function () { return __awaiter(_this, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        if (!(topicsToRemove.length > 0)) return [3 /*break*/, 2];\n                                        return [4 /*yield*/, this.subscribeRequest(\"DELETE\", { topics: topicsToRemove })];\n                                    case 1:\n                                        _a.sent();\n                                        _a.label = 2;\n                                    case 2:\n                                        if (!(topicsToAdd.length > 0)) return [3 /*break*/, 4];\n                                        return [4 /*yield*/, this.subscribeRequest(\"POST\", {\n                                                callbackId: subscription.callbackId,\n                                                topics: topicsToAdd\n                                            })];\n                                    case 3:\n                                        _a.sent();\n                                        _a.label = 4;\n                                    case 4: return [2 /*return*/];\n                                }\n                            });\n                        }); });\n                        subscription.topics = newTopics;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeJs.prototype.subscribeRequest = function (method, data) {\n        return fetch(this.hubUrl + \"/subscription\", {\n            method: method,\n            headers: {\n                'Authorization': \"Bearer \" + this.token,\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(data)\n        });\n    };\n    GazeJs.prototype.generateCallbackId = function () {\n        var UUID = Math.random().toString(36).substring(7);\n        if (this.subscriptions.find(function (s) { return s.callbackId == UUID; }) == null) {\n            return UUID;\n        }\n        return this.generateCallbackId();\n    };\n    return GazeJs;\n}());\nexport default GazeJs;\n"],"sourceRoot":""}