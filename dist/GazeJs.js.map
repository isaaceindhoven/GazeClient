{"version":3,"sources":["webpack://GazeJs/webpack/bootstrap","webpack://GazeJs/webpack/runtime/define property getters","webpack://GazeJs/webpack/runtime/hasOwnProperty shorthand","webpack://GazeJs/./src/Queue.ts","webpack://GazeJs/./src/Subscription.ts","webpack://GazeJs/./src/GazeJs.ts"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","n","v","op","TypeError","pop","length","push","Queue","queue","isBusy","add","callback","_a","process","shift","Subscription","callbackId","payloadCallback","topics","GazeJs","hubUrl","tokenUrl","connected","token","subscriptions","connectionResetCallback","connect","_this","res","req","SSE","_b","fetch","json","encodeURIComponent","EventSource","setTimeout","onmessage","m","data","JSON","parse","find","s","payload","onopen","i","subscription","subscribeRequest","onConnectionReset","on","topicsCallback","Error","console","error","generateCallbackId","update","newTopics","topicsToRemove","topicsToAdd","Array","isArray","from","Set","filter","map","warn","toString","includes","method","headers","stringify","UUID","Math","random","substring"],"mappings":"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","file":"GazeJs.js","sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar Queue = /** @class */ (function () {\n    function Queue() {\n        this.queue = [];\n        this.isBusy = false;\n    }\n    Queue.prototype.add = function (callback) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.queue.push(callback);\n                        return [4 /*yield*/, this.process()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Queue.prototype.process = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.isBusy || this.queue.length == 0)\n                            return [2 /*return*/];\n                        this.isBusy = true;\n                        return [4 /*yield*/, this.queue[0]()];\n                    case 1:\n                        _a.sent();\n                        this.queue.shift();\n                        this.isBusy = false;\n                        return [4 /*yield*/, this.process()];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return Queue;\n}());\nexport { Queue };\n","import { Queue } from \"./Queue\";\nvar Subscription = /** @class */ (function () {\n    function Subscription(callbackId, payloadCallback) {\n        this.callbackId = callbackId;\n        this.payloadCallback = payloadCallback;\n        this.topics = [];\n        this.queue = new Queue();\n    }\n    return Subscription;\n}());\nexport { Subscription };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { Subscription } from \"./Subscription\";\nvar GazeJs = /** @class */ (function () {\n    function GazeJs(hubUrl, tokenUrl) {\n        this.hubUrl = hubUrl;\n        this.tokenUrl = tokenUrl;\n        this.connected = false;\n        this.token = null;\n        this.subscriptions = [];\n        this.connectionResetCallback = null;\n    }\n    GazeJs.prototype.connect = function () {\n        var _this = this;\n        return new Promise(function (res) { return __awaiter(_this, void 0, void 0, function () {\n            var req, _a, SSE;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, fetch(this.tokenUrl)];\n                    case 1:\n                        req = _b.sent();\n                        _a = this;\n                        return [4 /*yield*/, req.json()];\n                    case 2:\n                        _a.token = (_b.sent()).token;\n                        this.token = encodeURIComponent(this.token);\n                        SSE = new EventSource(this.hubUrl + \"/sse?token=\" + this.token);\n                        setTimeout(function () {\n                            fetch(_this.hubUrl + \"/ping?token=\" + _this.token);\n                        }, 500);\n                        SSE.onmessage = function (m) {\n                            var _a;\n                            var data = JSON.parse(m.data);\n                            (_a = _this.subscriptions.find(function (s) { return s.callbackId == data.callbackId; })) === null || _a === void 0 ? void 0 : _a.payloadCallback(data.payload);\n                        };\n                        SSE.onopen = function () { return __awaiter(_this, void 0, void 0, function () {\n                            var i, subscription;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        this.connected = true;\n                                        if (!(this.subscriptions.length > 0)) return [3 /*break*/, 6];\n                                        i = 0;\n                                        _a.label = 1;\n                                    case 1:\n                                        if (!(i < this.subscriptions.length)) return [3 /*break*/, 4];\n                                        subscription = this.subscriptions[i];\n                                        return [4 /*yield*/, this.subscribeRequest(\"POST\", {\n                                                callbackId: subscription.callbackId,\n                                                topics: subscription.topics\n                                            })];\n                                    case 2:\n                                        _a.sent();\n                                        _a.label = 3;\n                                    case 3:\n                                        i++;\n                                        return [3 /*break*/, 1];\n                                    case 4:\n                                        if (!this.connectionResetCallback) return [3 /*break*/, 6];\n                                        return [4 /*yield*/, this.connectionResetCallback()];\n                                    case 5:\n                                        _a.sent();\n                                        _a.label = 6;\n                                    case 6:\n                                        res(this);\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); };\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    };\n    GazeJs.prototype.onConnectionReset = function (callback) {\n        this.connectionResetCallback = callback;\n    };\n    GazeJs.prototype.on = function (topicsCallback, payloadCallback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var subscription;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.connected)\n                            throw new Error(\"Gaze is not connected to a hub\");\n                        if (typeof topicsCallback !== 'function') {\n                            return [2 /*return*/, console.error(\"Topic callback must be a function\")];\n                        }\n                        subscription = new Subscription(this.generateCallbackId(), payloadCallback);\n                        this.subscriptions.push(subscription);\n                        return [4 /*yield*/, this.update(subscription, topicsCallback)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, {\n                                update: function () { return _this.update(subscription, topicsCallback); }\n                            }];\n                }\n            });\n        });\n    };\n    GazeJs.prototype.update = function (subscription, topicsCallback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var newTopics, topicsToRemove, topicsToAdd;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, topicsCallback()];\n                    case 1:\n                        newTopics = _a.sent();\n                        if (!Array.isArray(newTopics)) {\n                            return [2 /*return*/, console.error(\"Topic callback must return array\")];\n                        }\n                        newTopics = Array.from(new Set(newTopics));\n                        newTopics = newTopics.filter(function (t) { return !!t; }); // filter empty values\n                        newTopics = newTopics.map(function (t) {\n                            if (typeof t !== \"string\") {\n                                console.warn(\"Topic \" + t + \" was not a string\");\n                                t = t.toString();\n                            }\n                            return t;\n                        });\n                        topicsToRemove = subscription.topics.filter(function (t) { return !newTopics.includes(t); });\n                        topicsToAdd = newTopics.filter(function (t) { return !subscription.topics.includes(t); });\n                        if (topicsToRemove.length + topicsToAdd.length == 0)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, subscription.queue.add(function () { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0:\n                                            if (!(topicsToRemove.length > 0)) return [3 /*break*/, 2];\n                                            return [4 /*yield*/, this.subscribeRequest(\"DELETE\", { topics: topicsToRemove })];\n                                        case 1:\n                                            _a.sent();\n                                            _a.label = 2;\n                                        case 2:\n                                            if (!(topicsToAdd.length > 0)) return [3 /*break*/, 4];\n                                            return [4 /*yield*/, this.subscribeRequest(\"POST\", {\n                                                    callbackId: subscription.callbackId,\n                                                    topics: topicsToAdd\n                                                })];\n                                        case 3:\n                                            _a.sent();\n                                            _a.label = 4;\n                                        case 4: return [2 /*return*/];\n                                    }\n                                });\n                            }); })];\n                    case 2:\n                        _a.sent();\n                        subscription.topics = newTopics;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeJs.prototype.subscribeRequest = function (method, data) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, fetch(this.hubUrl + \"/subscription\", {\n                            method: method,\n                            headers: {\n                                'Authorization': \"Bearer \" + this.token,\n                                'Content-Type': 'application/json'\n                            },\n                            body: JSON.stringify(data)\n                        })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeJs.prototype.generateCallbackId = function () {\n        var UUID = Math.random().toString(36).substring(7);\n        if (this.subscriptions.find(function (s) { return s.callbackId == UUID; }) == null) {\n            return UUID;\n        }\n        return this.generateCallbackId();\n    };\n    return GazeJs;\n}());\nexport default GazeJs;\n"],"sourceRoot":""}