{"version":3,"sources":["webpack://GazeClient/webpack/universalModuleDefinition","webpack://GazeClient/webpack/bootstrap","webpack://GazeClient/webpack/runtime/define property getters","webpack://GazeClient/webpack/runtime/hasOwnProperty shorthand","webpack://GazeClient/./src/Queue.ts","webpack://GazeClient/./src/Subscription.ts","webpack://GazeClient/./src/Subscriptions.ts","webpack://GazeClient/./src/Requestors/FetchGazeRequestor.ts","webpack://GazeClient/./src/TopicsResolver.ts","webpack://GazeClient/./src/Middleware/Middleware.ts","webpack://GazeClient/./src/Middleware/LinkedList.ts","webpack://GazeClient/./src/GazeClient.ts"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","n","v","op","TypeError","pop","length","push","Queue","queue","isBusy","add","callback","_a","process","shift","Subscription","topics","getUnusedTopics","newTopics","filter","includes","flatten","arr","reduce","a","b","concat","Subscriptions","subscriptions","getByTopic","topic","s","create","payloadCallback","subscription","getAll","getAllTopics","map","topicsToRemove","subscribedTopics","getNewTopics","_this","remove","FetchGazeRequestor","hubUrl","setClientId","clientId","subscribe","subscribeRequest","unsubscribe","authenticate","token","payload","fetch","method","headers","JSON","stringify","unauthenticate","TopicsResolver","parse","Array","isArray","Error","evaluate","x","i","indexOf","console","warn","toString","Middleware","handle","handler","newPayload","LinkedList","first","last","item","GazeClient","sseClient","gazeRequestor","connected","middlewareList","onConnectionReset","connect","connecting","res","EventSource","onmessage","message","data_1","error_1","_b","data","reconnect","forEach","error","onopen","on","topicsResolver","update","destroy","topicsToRemove_1","topicsToAdd_1","error_2","addMiddleware","newMiddleware","_i","reset","disconnect","close"],"mappings":"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","file":"GazeClient.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"GazeClient\"] = factory();\n\telse\n\t\troot[\"GazeClient\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar Queue = /** @class */ (function () {\n    function Queue() {\n        this.queue = [];\n        this.isBusy = false;\n    }\n    Queue.prototype.add = function (callback) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.queue.push(callback);\n                        return [4 /*yield*/, this.process()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Queue.prototype.process = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.isBusy || this.queue.length == 0)\n                            return [2 /*return*/];\n                        this.isBusy = true;\n                        return [4 /*yield*/, this.queue[0]()];\n                    case 1:\n                        _a.sent();\n                        this.queue.shift();\n                        this.isBusy = false;\n                        return [4 /*yield*/, this.process()];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return Queue;\n}());\nexport { Queue };\n","import { Queue } from './Queue';\nvar Subscription = /** @class */ (function () {\n    function Subscription(callback) {\n        this.callback = callback;\n        this.topics = [];\n        this.queue = new Queue();\n    }\n    Subscription.prototype.getUnusedTopics = function (newTopics) {\n        return this.topics.filter(function (t) { return !newTopics.includes(t); });\n    };\n    return Subscription;\n}());\nexport { Subscription };\n","import { Subscription } from './Subscription';\nvar flatten = function (arr) { return arr.reduce(function (a, b) { return a.concat(b); }, []); };\nvar Subscriptions = /** @class */ (function () {\n    function Subscriptions() {\n        this.subscriptions = [];\n    }\n    Subscriptions.prototype.getByTopic = function (topic) {\n        return this.subscriptions.filter(function (s) { return s.topics.includes(topic); });\n    };\n    Subscriptions.prototype.create = function (payloadCallback) {\n        var subscription = new Subscription(payloadCallback);\n        this.subscriptions.push(subscription);\n        return subscription;\n    };\n    Subscriptions.prototype.getAll = function () {\n        return this.subscriptions;\n    };\n    Subscriptions.prototype.getAllTopics = function () {\n        return flatten(this.subscriptions.map(function (s) { return s.topics; }));\n    };\n    Subscriptions.prototype.getUnusedTopics = function (subscription, newTopics) {\n        var topicsToRemove = subscription.getUnusedTopics(newTopics);\n        var subscribedTopics = flatten(this.subscriptions.filter(function (s) { return s !== subscription; }).map(function (s) { return s.topics; }));\n        return topicsToRemove.filter(function (t) { return !subscribedTopics.includes(t); });\n    };\n    Subscriptions.prototype.getNewTopics = function (newTopics) {\n        var _this = this;\n        return newTopics.filter(function (t) { return !_this.getAllTopics().includes(t); });\n    };\n    Subscriptions.prototype.remove = function (subscription) {\n        this.subscriptions = this.subscriptions.filter(function (s) { return s !== subscription; });\n    };\n    return Subscriptions;\n}());\nexport { Subscriptions };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar FetchGazeRequestor = /** @class */ (function () {\n    function FetchGazeRequestor(hubUrl) {\n        this.hubUrl = hubUrl;\n    }\n    FetchGazeRequestor.prototype.setClientId = function (clientId) {\n        this.clientId = clientId;\n    };\n    FetchGazeRequestor.prototype.subscribe = function (topics) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.subscribeRequest('POST', topics)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    FetchGazeRequestor.prototype.unsubscribe = function (topics) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.subscribeRequest('DELETE', topics)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    FetchGazeRequestor.prototype.authenticate = function (token) {\n        return __awaiter(this, void 0, void 0, function () {\n            var payload;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        payload = {\n                            'id': this.clientId,\n                            token: token\n                        };\n                        return [4 /*yield*/, fetch(this.hubUrl + \"/auth\", {\n                                method: 'POST',\n                                headers: {\n                                    'Content-Type': 'application/json'\n                                },\n                                body: JSON.stringify(payload)\n                            })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    FetchGazeRequestor.prototype.unauthenticate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, fetch(this.hubUrl + \"/auth\", {\n                            method: 'DELETE',\n                            headers: {\n                                'Authorization': \"Bearer \" + this.clientId\n                            }\n                        })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    FetchGazeRequestor.prototype.subscribeRequest = function (method, topics) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (topics.length == 0)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, fetch(this.hubUrl + \"/subscription\", {\n                                method: method,\n                                headers: {\n                                    'Authorization': \"Bearer \" + this.clientId,\n                                    'Content-Type': 'application/json'\n                                },\n                                body: JSON.stringify({\n                                    topics: topics\n                                })\n                            })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return FetchGazeRequestor;\n}());\nexport { FetchGazeRequestor };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar TopicsResolver = /** @class */ (function () {\n    function TopicsResolver(callback) {\n        this.callback = callback;\n    }\n    TopicsResolver.parse = function (topics) {\n        if (Array.isArray(topics)) {\n            return new TopicsResolver(function () { return topics; });\n        }\n        if (typeof topics === 'string') {\n            return new TopicsResolver(function () { return [topics]; });\n        }\n        if (typeof topics !== 'function') {\n            throw new Error('Topic callback must be a function');\n        }\n        return new TopicsResolver(topics);\n    };\n    TopicsResolver.prototype.evaluate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var newTopics;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.callback()];\n                    case 1:\n                        newTopics = _a.sent();\n                        if (!Array.isArray(newTopics)) {\n                            throw new Error('Topic callback must return array');\n                        }\n                        newTopics = newTopics.filter(function (x, i, a) { return a.indexOf(x) == i; });\n                        newTopics = newTopics.filter(function (t) { return !!t; }); // filter empty values\n                        newTopics = newTopics.map(function (t) {\n                            if (typeof t !== 'string') {\n                                console.warn(\"Topic \" + t + \" was not a string\");\n                                t = t.toString();\n                            }\n                            return t;\n                        });\n                        return [2 /*return*/, newTopics];\n                }\n            });\n        });\n    };\n    return TopicsResolver;\n}());\nexport { TopicsResolver };\n","var Middleware = /** @class */ (function () {\n    function Middleware() {\n    }\n    Middleware.prototype.handle = function (payload) {\n        var _this = this;\n        return new Promise(function (resolve) {\n            _this.handler(payload, function (newPayload) {\n                if (_this.next) {\n                    _this.next.handle(newPayload).then(resolve);\n                }\n                else {\n                    resolve(newPayload);\n                }\n            });\n        });\n    };\n    return Middleware;\n}());\nexport { Middleware };\n","var LinkedList = /** @class */ (function () {\n    function LinkedList() {\n        this.first = null;\n        this.last = null;\n    }\n    LinkedList.prototype.add = function (item) {\n        if (this.first === null) {\n            this.first = item;\n        }\n        else {\n            this.last.next = item;\n        }\n        this.last = item;\n    };\n    return LinkedList;\n}());\nexport { LinkedList };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { Subscriptions } from './Subscriptions';\nimport { FetchGazeRequestor } from './Requestors/FetchGazeRequestor';\nimport { TopicsResolver } from './TopicsResolver';\nimport { Middleware } from './Middleware/Middleware';\nimport { LinkedList } from './Middleware/LinkedList';\nvar GazeClient = /** @class */ (function () {\n    function GazeClient(hubUrl, sseClient, gazeRequestor) {\n        if (sseClient === void 0) { sseClient = null; }\n        if (gazeRequestor === void 0) { gazeRequestor = null; }\n        this.hubUrl = hubUrl;\n        this.sseClient = sseClient;\n        this.gazeRequestor = gazeRequestor;\n        this.connected = false;\n        this.subscriptions = new Subscriptions();\n        this.middlewareList = new LinkedList();\n        this.onConnectionReset = null;\n        if (this.gazeRequestor === null) {\n            this.gazeRequestor = new FetchGazeRequestor(this.hubUrl);\n        }\n    }\n    GazeClient.prototype.connect = function () {\n        var _this = this;\n        if (this.connecting) {\n            return this.connecting;\n        }\n        this.connecting = new Promise(function (res) {\n            if (_this.sseClient === null) {\n                _this.sseClient = new EventSource(_this.hubUrl + \"/sse\");\n            }\n            _this.sseClient.onmessage = function (message) { return __awaiter(_this, void 0, void 0, function () {\n                var data_1, _a, error_1;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            _b.trys.push([0, 5, , 6]);\n                            data_1 = JSON.parse(message.data);\n                            if (!data_1['id']) return [3 /*break*/, 2];\n                            this.gazeRequestor.setClientId(data_1['id']);\n                            return [4 /*yield*/, this.reconnect()];\n                        case 1:\n                            _b.sent();\n                            return [2 /*return*/, res(this)];\n                        case 2:\n                            if (!this.middlewareList.first) return [3 /*break*/, 4];\n                            _a = data_1;\n                            return [4 /*yield*/, this.middlewareList.first.handle(data_1.payload)];\n                        case 3:\n                            _a.payload = _b.sent();\n                            _b.label = 4;\n                        case 4:\n                            this.subscriptions\n                                .getByTopic(data_1.topic)\n                                .forEach(function (s) { return s.callback(data_1.payload); });\n                            return [3 /*break*/, 6];\n                        case 5:\n                            error_1 = _b.sent();\n                            console.error(error_1);\n                            return [3 /*break*/, 6];\n                        case 6: return [2 /*return*/];\n                    }\n                });\n            }); };\n            _this.sseClient.onopen = function () { return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                    this.connected = true;\n                    return [2 /*return*/];\n                });\n            }); };\n        });\n        return this.connecting;\n    };\n    GazeClient.prototype.on = function (topics, callback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var topicsResolver, subscription;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.connect()];\n                    case 1:\n                        _a.sent();\n                        if (typeof callback !== 'function') {\n                            throw new Error('Callback must be a function');\n                        }\n                        topicsResolver = TopicsResolver.parse(topics);\n                        subscription = this.subscriptions.create(callback);\n                        return [4 /*yield*/, this.update(subscription, topicsResolver)];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/, {\n                                update: function () { return _this.update(subscription, topicsResolver); },\n                                destroy: function () { return _this.destroy(subscription); }\n                            }];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.update = function (subscription, topicsResolver) {\n        return __awaiter(this, void 0, void 0, function () {\n            var newTopics, topicsToRemove_1, topicsToAdd_1, error_2;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 3, , 4]);\n                        return [4 /*yield*/, topicsResolver.evaluate()];\n                    case 1:\n                        newTopics = _a.sent();\n                        topicsToRemove_1 = this.subscriptions.getUnusedTopics(subscription, newTopics);\n                        topicsToAdd_1 = this.subscriptions.getNewTopics(newTopics);\n                        return [4 /*yield*/, subscription.queue.add(function () { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0:\n                                            if (!(topicsToRemove_1.length > 0)) return [3 /*break*/, 2];\n                                            return [4 /*yield*/, this.gazeRequestor.unsubscribe(topicsToRemove_1)];\n                                        case 1:\n                                            _a.sent();\n                                            _a.label = 2;\n                                        case 2:\n                                            if (!(topicsToAdd_1.length > 0)) return [3 /*break*/, 4];\n                                            return [4 /*yield*/, this.gazeRequestor.subscribe(topicsToAdd_1)];\n                                        case 3:\n                                            _a.sent();\n                                            _a.label = 4;\n                                        case 4: return [2 /*return*/];\n                                    }\n                                });\n                            }); })];\n                    case 2:\n                        _a.sent();\n                        subscription.topics = newTopics;\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_2 = _a.sent();\n                        return [2 /*return*/, console.error(error_2)];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.destroy = function (subscription) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.update(subscription, new TopicsResolver(function () { return []; }))];\n                    case 1:\n                        _a.sent();\n                        this.subscriptions.remove(subscription);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.addMiddleware = function (handler) {\n        var newMiddleware = new Middleware();\n        newMiddleware.handler = handler;\n        this.middlewareList.add(newMiddleware);\n    };\n    GazeClient.prototype.authenticate = function (token) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.connect()];\n                    case 1:\n                        _a.sent();\n                        this.token = token;\n                        return [4 /*yield*/, this.gazeRequestor.authenticate(this.token)];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.reconnect = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _i, _a, subscription;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this.token) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.gazeRequestor.authenticate(this.token)];\n                    case 1:\n                        _b.sent();\n                        _b.label = 2;\n                    case 2:\n                        if (this.subscriptions.getAll().length == 0)\n                            return [2 /*return*/];\n                        _i = 0, _a = this.subscriptions.getAll();\n                        _b.label = 3;\n                    case 3:\n                        if (!(_i < _a.length)) return [3 /*break*/, 6];\n                        subscription = _a[_i];\n                        return [4 /*yield*/, this.gazeRequestor.subscribe(subscription.topics)];\n                    case 4:\n                        _b.sent();\n                        _b.label = 5;\n                    case 5:\n                        _i++;\n                        return [3 /*break*/, 3];\n                    case 6:\n                        if (!this.onConnectionReset) return [3 /*break*/, 8];\n                        return [4 /*yield*/, this.onConnectionReset()];\n                    case 7:\n                        _b.sent();\n                        _b.label = 8;\n                    case 8: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.unauthenticate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.token || !this.connected)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, this.gazeRequestor.unauthenticate()];\n                    case 1:\n                        _a.sent();\n                        this.token = null;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.reset = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.gazeRequestor.unsubscribe(this.subscriptions.getAllTopics())];\n                    case 1:\n                        _a.sent();\n                        this.subscriptions = new Subscriptions();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.disconnect = function () {\n        this.sseClient.close();\n        this.subscriptions = new Subscriptions();\n        this.token = null;\n    };\n    return GazeClient;\n}());\nexport default GazeClient;\n"],"sourceRoot":""}