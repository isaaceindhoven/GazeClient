{"version":3,"sources":["webpack://GazeClient/webpack/universalModuleDefinition","webpack://GazeClient/webpack/bootstrap","webpack://GazeClient/webpack/runtime/define property getters","webpack://GazeClient/webpack/runtime/hasOwnProperty shorthand","webpack://GazeClient/webpack/runtime/make namespace object","webpack://GazeClient/./src/Queue.ts","webpack://GazeClient/./src/Subscription.ts","webpack://GazeClient/./src/GazeRequestor.ts","webpack://GazeClient/./src/TopicsResolver.ts","webpack://GazeClient/./src/GazeClient.ts"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","iterator","this","n","v","op","TypeError","pop","length","push","Queue","queue","isBusy","add","callback","_a","process","shift","Subscription","callbackId","payloadCallback","topics","topicsToRemove","newTopics","filter","includes","topicsToAdd","_this","Subscriptions","subscriptions","getById","find","s","create","Error","subscription","generateCallbackId","id","Math","random","toString","substring","getAll","GazeRequestor","hubUrl","token","ping","fetch","connect","EventSource","subscibe","data","subscribeRequest","unsubscibe","method","headers","JSON","stringify","TopicsResolver","parse","Array","isArray","evaluate","x","i","a","indexOf","map","console","warn","GazeClient","connected","connectionResetCallback","gazeRequestor","res","SSE","setTimeout","onmessage","m","payload","error","onopen","reconnect","on","topicsResolver","update","topicsToRemove_1","topicsToAdd_1","error_1","_i","_b","onConnectionReset"],"mappings":"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","file":"GazeClient.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"GazeClient\"] = factory();\n\telse\n\t\troot[\"GazeClient\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar Queue = /** @class */ (function () {\n    function Queue() {\n        this.queue = [];\n        this.isBusy = false;\n    }\n    Queue.prototype.add = function (callback) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.queue.push(callback);\n                        return [4 /*yield*/, this.process()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Queue.prototype.process = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.isBusy || this.queue.length == 0)\n                            return [2 /*return*/];\n                        this.isBusy = true;\n                        return [4 /*yield*/, this.queue[0]()];\n                    case 1:\n                        _a.sent();\n                        this.queue.shift();\n                        this.isBusy = false;\n                        return [4 /*yield*/, this.process()];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return Queue;\n}());\nexport { Queue };\n","import { Queue } from \"./Queue\";\nvar Subscription = /** @class */ (function () {\n    function Subscription(callbackId, payloadCallback) {\n        this.callbackId = callbackId;\n        this.payloadCallback = payloadCallback;\n        this.topics = [];\n        this.queue = new Queue();\n    }\n    Subscription.prototype.topicsToRemove = function (newTopics) {\n        return this.topics.filter(function (t) { return !newTopics.includes(t); });\n    };\n    Subscription.prototype.topicsToAdd = function (newTopics) {\n        var _this = this;\n        return newTopics.filter(function (t) { return !_this.topics.includes(t); });\n    };\n    return Subscription;\n}());\nvar Subscriptions = /** @class */ (function () {\n    function Subscriptions() {\n        this.subscriptions = [];\n    }\n    Subscriptions.prototype.getById = function (callbackId) {\n        return this.subscriptions.find(function (s) { return s.callbackId == callbackId; });\n    };\n    Subscriptions.prototype.create = function (payloadCallback) {\n        if (typeof payloadCallback !== \"function\") {\n            throw new Error(\"Callback must be a function\");\n        }\n        var subscription = new Subscription(this.generateCallbackId(), payloadCallback);\n        this.subscriptions.push(subscription);\n        return subscription;\n    };\n    Subscriptions.prototype.generateCallbackId = function () {\n        var id = Math.random().toString(36).substring(7);\n        if (this.subscriptions.find(function (s) { return s.callbackId == id; }) == null) {\n            return id;\n        }\n        return this.generateCallbackId();\n    };\n    Subscriptions.prototype.getAll = function () {\n        return this.subscriptions;\n    };\n    return Subscriptions;\n}());\nexport { Subscription, Subscriptions };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar GazeRequestor = /** @class */ (function () {\n    function GazeRequestor(hubUrl, token) {\n        this.hubUrl = hubUrl;\n        this.token = token;\n    }\n    GazeRequestor.prototype.ping = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, fetch(this.hubUrl + \"/ping?token=\" + this.token)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeRequestor.prototype.connect = function () {\n        return new EventSource(this.hubUrl + \"/sse?token=\" + this.token);\n    };\n    GazeRequestor.prototype.subscibe = function (data) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.subscribeRequest(\"POST\", data)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeRequestor.prototype.unsubscibe = function (data) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.subscribeRequest(\"DELETE\", data)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeRequestor.prototype.subscribeRequest = function (method, data) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (data.topics.length == 0)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, fetch(this.hubUrl + \"/subscription\", {\n                                method: method,\n                                headers: {\n                                    'Authorization': \"Bearer \" + this.token,\n                                    'Content-Type': 'application/json'\n                                },\n                                body: JSON.stringify(data)\n                            })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return GazeRequestor;\n}());\nexport { GazeRequestor };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar TopicsResolver = /** @class */ (function () {\n    function TopicsResolver(callback) {\n        this.callback = callback;\n    }\n    TopicsResolver.parse = function (topics) {\n        if (Array.isArray(topics)) {\n            return new TopicsResolver(function () { return topics; });\n        }\n        if (typeof topics === \"string\") {\n            return new TopicsResolver(function () { return [topics]; });\n        }\n        if (typeof topics !== 'function') {\n            throw new Error(\"Topic callback must be a function\");\n        }\n        return new TopicsResolver(topics);\n    };\n    TopicsResolver.prototype.evaluate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var newTopics;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.callback()];\n                    case 1:\n                        newTopics = _a.sent();\n                        if (!Array.isArray(newTopics)) {\n                            throw new Error(\"Topic callback must return array\");\n                        }\n                        newTopics = newTopics.filter(function (x, i, a) { return a.indexOf(x) == i; });\n                        newTopics = newTopics.filter(function (t) { return !!t; }); // filter empty values\n                        newTopics = newTopics.map(function (t) {\n                            if (typeof t !== \"string\") {\n                                console.warn(\"Topic \" + t + \" was not a string\");\n                                t = t.toString();\n                            }\n                            return t;\n                        });\n                        return [2 /*return*/, newTopics];\n                }\n            });\n        });\n    };\n    return TopicsResolver;\n}());\nexport { TopicsResolver };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { Subscriptions } from \"./Subscription\";\nimport { GazeRequestor } from \"./GazeRequestor\";\nimport { TopicsResolver } from \"./TopicsResolver\";\nvar GazeClient = /** @class */ (function () {\n    function GazeClient(hubUrl, token) {\n        this.connected = false;\n        this.subscriptions = new Subscriptions();\n        this.connectionResetCallback = null;\n        this.gazeRequestor = null;\n        this.gazeRequestor = new GazeRequestor(hubUrl, token);\n    }\n    GazeClient.prototype.connect = function () {\n        var _this = this;\n        return new Promise(function (res) { return __awaiter(_this, void 0, void 0, function () {\n            var SSE;\n            var _this = this;\n            return __generator(this, function (_a) {\n                SSE = this.gazeRequestor.connect();\n                setTimeout(function () { return _this.gazeRequestor.ping(); }, 500);\n                SSE.onmessage = function (m) {\n                    var _a;\n                    try {\n                        var data = JSON.parse(m.data);\n                        (_a = _this.subscriptions.getById(data.callbackId)) === null || _a === void 0 ? void 0 : _a.payloadCallback(data.payload);\n                    }\n                    catch (error) {\n                        console.error(error);\n                    }\n                };\n                SSE.onopen = function () { return __awaiter(_this, void 0, void 0, function () {\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                this.connected = true;\n                                return [4 /*yield*/, this.reconnect()];\n                            case 1:\n                                _a.sent();\n                                res(this);\n                                return [2 /*return*/];\n                        }\n                    });\n                }); };\n                return [2 /*return*/];\n            });\n        }); });\n    };\n    GazeClient.prototype.on = function (topics, payloadCallback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var topicsResolver, subscription;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.connected)\n                            throw new Error(\"Gaze is not connected to a hub\");\n                        topicsResolver = TopicsResolver.parse(topics);\n                        subscription = this.subscriptions.create(payloadCallback);\n                        return [4 /*yield*/, this.update(subscription, topicsResolver)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, {\n                                update: function () { return _this.update(subscription, topicsResolver); }\n                            }];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.update = function (subscription, topicsResolver) {\n        return __awaiter(this, void 0, void 0, function () {\n            var newTopics, topicsToRemove_1, topicsToAdd_1, error_1;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 3, , 4]);\n                        return [4 /*yield*/, topicsResolver.evaluate()];\n                    case 1:\n                        newTopics = _a.sent();\n                        topicsToRemove_1 = subscription.topicsToRemove(newTopics);\n                        topicsToAdd_1 = subscription.topicsToAdd(newTopics);\n                        if (topicsToRemove_1.length + topicsToAdd_1.length == 0)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, subscription.queue.add(function () { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.gazeRequestor.unsubscibe({ topics: topicsToRemove_1 })];\n                                        case 1:\n                                            _a.sent();\n                                            return [4 /*yield*/, this.gazeRequestor.subscibe({\n                                                    callbackId: subscription.callbackId,\n                                                    topics: topicsToAdd_1\n                                                })];\n                                        case 2:\n                                            _a.sent();\n                                            return [2 /*return*/];\n                                    }\n                                });\n                            }); })];\n                    case 2:\n                        _a.sent();\n                        subscription.topics = newTopics;\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_1 = _a.sent();\n                        return [2 /*return*/, console.error(error_1)];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.reconnect = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _i, _a, subscription;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!(this.subscriptions.getAll().length > 0)) return [3 /*break*/, 6];\n                        _i = 0, _a = this.subscriptions.getAll();\n                        _b.label = 1;\n                    case 1:\n                        if (!(_i < _a.length)) return [3 /*break*/, 4];\n                        subscription = _a[_i];\n                        return [4 /*yield*/, this.gazeRequestor.subscibe({\n                                callbackId: subscription.callbackId,\n                                topics: subscription.topics\n                            })];\n                    case 2:\n                        _b.sent();\n                        _b.label = 3;\n                    case 3:\n                        _i++;\n                        return [3 /*break*/, 1];\n                    case 4:\n                        if (!this.connectionResetCallback) return [3 /*break*/, 6];\n                        return [4 /*yield*/, this.connectionResetCallback()];\n                    case 5:\n                        _b.sent();\n                        _b.label = 6;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GazeClient.prototype.onConnectionReset = function (callback) {\n        this.connectionResetCallback = callback;\n    };\n    return GazeClient;\n}());\nexport default GazeClient;\n"],"sourceRoot":""}